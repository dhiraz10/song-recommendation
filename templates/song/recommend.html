{% extends 'master/base.html' %}
{% load static %}

{% block title %}
  Play Songs
{% endblock %}

{% block customcss %}
<link rel="stylesheet" href="{% static 'css/jquery.rateyo.min.css' %}"/>
<style media="screen">
  a:hover {
    text-decoration:none;
  }
.btn {
  border: none;
background: #6699CC;
color: #ffffff !important;
font-weight: 100;
padding: 10px;
text-transform: uppercase;
border-radius: 6px;
display: inline-block;
transition: all 0.3s ease 0s;
}
  .btn:hover {
color: #404040 !important;
font-weight: 700 !important;
letter-spacing: 3px;
background: none;
-webkit-box-shadow: 0px 5px 40px -10px rgba(0,0,0,0.57);
-moz-box-shadow: 0px 5px 40px -10px rgba(0,0,0,0.57);
transition: all 0.3s ease 0s;
}
#con:hover .overlay {
  opacity: 0.8;
}
.icon {
  color: white;
  font-size: 100px;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  -ms-transform: translate(-50%, -50%);
  text-align: center;
}
.glyphicon glyphicon-play-circle:hover  {
  color: #eee;
  opacity: 50;
}
  body {
   background: linear-gradient(90deg, #A8D1E7, #FBFAFC);

}
</style>
{% endblock %}

{% block bodycontent %}

<div class="container">
  <div class="row">
    <div class="pagination" style="float:left;padding-top:45px;margin-bottom:0px;">
      <span class="step-links">
        <ul class="pagination pagination-sm">
      <li>  <button class="btn " > <a href="{% url 'song:dashboard' %}" style="color: ghostwhite" >Back</a></button></li>
      </ul>
      </span>
    </div>
  </div>
</div>

<div class="container" style="padding-top:0px;margin-top:0px;">
<div class="row">
  <div class="col-md-4 col-md-offset-4 text-center">
    <h2 class="page-header" style="padding-top:2px;margin-top:0px;">Now Playing</h2>
    <div class="well well-sm" style="background:#6699cc;padding-right:5px;height:210px;width:200px; margin-left: auto; margin-right: auto">
      {% if song.image %}
        <img src="{{song.image.url}}" alt="" style="height:100%;width:100%;">
      {% endif %}
    </div>
    <p style="padding-left:5px;"><strong>{{ song.name }}</strong> </p>
    <audio controls loop autoplay style="margin-bottom:10px">
      <source src="{{MEDIA_URL}}{{song.file.url}}" type="audio/ogg">
        <source src="{{MEDIA_URL}}{{song.file.url}}" type="audio/mpeg">
    </audio>
    <div class="text-center">
        <div style="margin:10px 0">
            <div id="rateYo" style="margin:0 auto;"></div> 
            <small>({{reviews.count}} reviews)</small>
        </div>
        {% if hasUserRated == False %}
        <button class="btn " data-toggle="modal" data-target="#ratingModal">Rate this Song</button>
        {% endif %}
    </div>
  </div>
</div>
</div>

{% if hasUserRated == False %}
<!--Rating Modal -->
<div class="modal fade" id="ratingModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <form class="modal-content" action="{% url 'song:rate' song.id %}" method="post">
        {% csrf_token %}
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Rate this Song</h4>
      </div>
      <div class="modal-body">
        <div class="form-group">
            <div id="rateYoInput"></div>
            <input type="hidden" name="rating" value="0">
        </div>
        <div>
          <label>Short Review</label>
          <textarea name="review" class="form-control" rows="5" maxlength="400"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">Submit</button>
      </div>
    </form>
  </div>
</div>
{% endif %}

{% if reviews %}
<div class="container" style="padding-top:10px;">
    <h2 class="page-header">Reviews</h2>
  <div class="row">
    {% for review in reviews%}
    <div class="col-md-6">
      <h4>{{review.user}}</h4>
      <div id="songrateYo{{review.id}}" style="margin-bottom: 10px; padding-left: 0"></div>  
      <p>{{review.review}}</p>
      </div>
    {% endfor %}
  </div>
</div>
  {% endif %}

<div class="container" style="padding-top:10px;">
    <h2 class="page-header">Recommended</h2>
<div class="row">
  {% for song in resongs%}
  <div class="col-md-4">
    <div class="well well-sm" style="background:maroon;padding-right:5px;height:210px;width:200px;">
      {% if song.image %}
      <div class="container" id="con" style="position: relative;width:100%;">
        <img src="{{song.image.url}}" class="image" alt="" style="height:150px;width:150px;display:block;">
        <div class="overlay">
          <a href="{% url 'song:recommend' song.id %}" class="icon">
            <i class="glyphicon glyphicon-play-circle"></i>
          </a>
        </div>
      </div>
      {% endif %}
      <strong><p style="color:white;"><i class="glyphicon glyphicon-play-circle"style="padding:5px;"></i>{{ song.name }}</p></strong>
    </div>
  </div>
  {% endfor %}
</div>
</div>

{% if similar_song %}
<div class="container" style="padding-top:10px;">
    <h2 class="page-header">Similar</h2>
<div class="row">
  {% for song in similar_song%}
  <div class="col-md-4">
    <div class="well well-sm" style="background:maroon;padding-right:5px;height:210px;width:200px;">
      {% if song.image %}
      <div class="container" id="con" style="position: relative;width:100%;">
        <img src="{{song.image.url}}" class="image" alt="" style="height:150px;width:150px;display:block;">
        <div class="overlay">
          <a href="{% url 'song:recommend' song.id %}" class="icon">
            <i class="glyphicon glyphicon-play-circle"></i>
          </a>
        </div>
      </div>
      {% endif %}
      <strong><p style="color:white;"><i class="glyphicon glyphicon-play-circle"style="padding:5px;"></i>{{ song.name }}</p></strong>
    </div>
  </div>
  {% endfor %}
</div>
</div>
{% endif %}
{% endblock %}
{% block javascript %}
<script src="{% static 'js/jquery.rateyo.min.js' %}"></script>
<script>
  $(function(){
    $("#rateYo").rateYo({
      rating: "{{averageRating}}",
      starWidth: "20px",
      normalFill: "#ccc",
      ratedFill: "maroon",
      readOnly: true,
    });

    $("#rateYoInput").rateYo({
      rating: 0,
      starWidth: "25px",
      normalFill: "#ccc",
      ratedFill: "maroon",
      fullStar: true,
      onChange: function (rating) {
        $("input[name='rating']").val(rating);
      }
    }); 
    {% if reviews %}
    {% for review in reviews%}
    $("#songrateYo{{review.id}}").rateYo({
      rating: "{{review.rating}}",
      starWidth: "15px",
      normalFill: "#ccc",
      ratedFill: "maroon",
      readOnly: true,
    });  
    {% endfor %}
    {% endif %}
  });
</script>
{% endblock %}
